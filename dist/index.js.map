{"version":3,"sources":["../src/index.js"],"names":["cors","require","app","use","bodyParser","json","fs","https","cert","readFileSync","key","port","process","env","PORT","express","urlencoded","extended","credentials","authenticate","req","res","next","httpRequest","then","statusCode","message","catch","e","console","log","post","sendmailController","get","headers","data","set","status","send","end","all","staffController","put","activitiesController","delete","subscriberController","authController","listen","httpServer","createServer"],"mappings":"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","sourcesContent":["import express from 'express'\nimport bodyParser from 'body-parser'\n\nimport handleAuthRequest from './auth'\nimport handleStaffRequest from './staff'\nimport handleActivitiesRequest from './activities'\nimport handleSubscriberRequest from './subscribers'\nimport handleSendmailRequest from './mailer'\nimport adaptRequest from './helpers/adapt-request'\n\nvar cors = require('cors')\nconst app = express();\napp.use(bodyParser.json());\n\nconst fs = require('fs')\nconst https = require('https')\n\n\nconst cert = fs.readFileSync('src/certificate.crt')\nconst key = fs.readFileSync('src/private.key')\n\nconst port = process.env.PORT || 9090;\n\n//Middleware\napp.use(express.urlencoded({ extended: true}));\napp.use(express.json());\n\napp.use(cors());\n\n// app.get('/.well-known/pki-validation/39E87E8F368589DE8F7FFB9F4D079CFA.txt', (req, res) => {\n//   res.sendFile('/home/ec2-user/backend/src/39E87E8F368589DE8F7FFB9F4D079CFA.txt')\n// })\n\nconst credentials = {\n  key,\n  cert\n}\n\nfunction authenticate (req, res, next) {\n  const httpRequest = adaptRequest(req)\n  \n  handleAuthRequest(httpRequest)\n      .then(({ statusCode }) => {\n       \n        if(statusCode == 200){\n          next();\n        } \n        else {\n          // console.log(\"Unauthorized access\")\n          res.json({message: \"Unauthorized access\"})\n        }\n\n    })\n    .catch(e => {console.log(e)})\n}\n\n\napp.post('/sendmail', sendmailController);\napp.get('/sendmail', sendmailController);\n\nfunction sendmailController (req, res) {\n  const httpRequest = adaptRequest(req)\n  handleSendmailRequest(httpRequest)\n      .then(({ headers, statusCode, data }) =>\n      res\n          .set(headers)\n          .status(statusCode) \n          .send(data)\n      )\n      .catch(e => res.status(500).end())\n}\n\n\napp.all('/staff', staffController);\napp.put('/staff', staffController);\napp.post('/staff/add', authenticate, staffController);\napp.post('/staff/auth', staffController);\n// app.post('/staff/reset', staffController);\napp.get('/staff/:id', staffController);\n// app.delete('/staff/?id=:id', staffController);\napp.get('/staff/?id=:id', staffController);\napp.get('/staff/find/?email=:email', staffController);\n\nfunction staffController (req, res) {\n    const httpRequest = adaptRequest(req)\n    handleStaffRequest(httpRequest)\n        .then(({ headers, statusCode, data }) =>\n        res\n            .set(headers)\n            .status(statusCode) \n            .send(data)\n        )\n        .catch(e => res.status(500).end())\n}\n\n\n\napp.get('/activities', activitiesController);\napp.post('/activities/add', activitiesController);\napp.delete('/activities/:id', activitiesController);\napp.get('/activities?month=:month', activitiesController);\napp.get('/activities?year=:year', activitiesController);\n\n\nfunction activitiesController (req, res) {\n  \n  const httpRequest = adaptRequest(req)\n  handleActivitiesRequest(httpRequest)\n    .then(({ headers, statusCode, data }) =>\n      res\n        .set(headers)\n        .status(statusCode) \n        .send(data)\n    )\n    .catch(e => res.status(500).end())\n}\n\n\n\n\napp.all('/subscriber', subscriberController);\napp.post('/subscriber/add', subscriberController);\napp.put('/subscriber', subscriberController);\napp.post('/subscriber/update', subscriberController);\napp.delete('/subscriber?id=:id', subscriberController);\napp.get('/subscriber/:id', subscriberController);\napp.get('/subscriber?id=:id', subscriberController);\n\nfunction subscriberController (req, res) {\n  \n  const httpRequest = adaptRequest(req)\n  handleSubscriberRequest(httpRequest)\n    .then(({ headers, statusCode, data }) =>\n      res\n        .set(headers)\n        .status(statusCode) \n        .send(data)\n    )\n    .catch(e => res.status(500).end())\n}\n\n\n\napp.all('/auth', authController);\napp.get('/auth/:id', authController);\napp.get('/auth/check_token', authController);\n\nfunction authController (req, res) {\n  const httpRequest = adaptRequest(req)\n  handleAuthRequest(httpRequest)\n      .then(({ headers, statusCode, data }) =>\n      res\n          .set(headers)\n          .status(statusCode) \n          .send(data)\n      )\n      .catch(e => res.status(500).end())\n}\n\n\napp.listen(port, () => console.log(`Listening on port 9090`+process.env.PORT || 9090));\n\nconst httpServer = https.createServer(credentials, app);\nhttpServer.listen(9443)"],"file":"index.js"}