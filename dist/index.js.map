{"version":3,"sources":["../src/index.js"],"names":["cors","require","app","use","bodyParser","json","fs","https","cert","readFileSync","key","port","process","env","PORT","express","urlencoded","extended","get","req","res","sendFile","credentials","authenticate","next","httpRequest","then","statusCode","message","catch","e","console","log","post","sendmailController","headers","data","set","status","send","end","all","staffController","put","activitiesController","delete","subscriberController","authController","listen","httpServer","createServer"],"mappings":";;AAAA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,IAAIA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAAlB;;AACA,MAAMC,GAAG,GAAG,uBAAZ;AACAA,GAAG,CAACC,GAAJ,CAAQC,oBAAWC,IAAX,EAAR;;AAEA,MAAMC,EAAE,GAAGL,OAAO,CAAC,IAAD,CAAlB;;AACA,MAAMM,KAAK,GAAGN,OAAO,CAAC,OAAD,CAArB;;AAGA,MAAMO,IAAI,GAAGF,EAAE,CAACG,YAAH,CAAgB,qBAAhB,CAAb;AACA,MAAMC,GAAG,GAAGJ,EAAE,CAACG,YAAH,CAAgB,iBAAhB,CAAZ;AAEA,MAAME,IAAI,GAAGC,OAAO,CAACC,GAAR,CAAYC,IAAZ,IAAoB,IAAjC,C,CAEA;;AACAZ,GAAG,CAACC,GAAJ,CAAQY,iBAAQC,UAAR,CAAmB;AAAEC,EAAAA,QAAQ,EAAE;AAAZ,CAAnB,CAAR;AACAf,GAAG,CAACC,GAAJ,CAAQY,iBAAQV,IAAR,EAAR;AAEAH,GAAG,CAACC,GAAJ,CAAQH,IAAI,EAAZ;AAEAE,GAAG,CAACgB,GAAJ,CAAQ,kEAAR,EAA4E,CAACC,GAAD,EAAMC,GAAN,KAAc;AACxFA,EAAAA,GAAG,CAACC,QAAJ,CAAa,iEAAb;AACD,CAFD;AAIA,MAAMC,WAAW,GAAG;AAClBZ,EAAAA,GADkB;AAElBF,EAAAA;AAFkB,CAApB;;AAKA,SAASe,YAAT,CAAuBJ,GAAvB,EAA4BC,GAA5B,EAAiCI,IAAjC,EAAuC;AACrC,QAAMC,WAAW,GAAG,2BAAaN,GAAb,CAApB;AAEA,qBAAkBM,WAAlB,EACKC,IADL,CACU,CAAC;AAAEC,IAAAA;AAAF,GAAD,KAAoB;AAExB,QAAGA,UAAU,IAAI,GAAjB,EAAqB;AACnBH,MAAAA,IAAI;AACL,KAFD,MAGK;AACH;AACAJ,MAAAA,GAAG,CAACf,IAAJ,CAAS;AAACuB,QAAAA,OAAO,EAAE;AAAV,OAAT;AACD;AAEJ,GAXH,EAYGC,KAZH,CAYSC,CAAC,IAAI;AAACC,IAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AAAe,GAZ9B;AAaD;;AAGD5B,GAAG,CAAC+B,IAAJ,CAAS,WAAT,EAAsBC,kBAAtB;AACAhC,GAAG,CAACgB,GAAJ,CAAQ,WAAR,EAAqBgB,kBAArB;;AAEA,SAASA,kBAAT,CAA6Bf,GAA7B,EAAkCC,GAAlC,EAAuC;AACrC,QAAMK,WAAW,GAAG,2BAAaN,GAAb,CAApB;AACA,uBAAsBM,WAAtB,EACKC,IADL,CACU,CAAC;AAAES,IAAAA,OAAF;AAAWR,IAAAA,UAAX;AAAuBS,IAAAA;AAAvB,GAAD,KACNhB,GAAG,CACEiB,GADL,CACSF,OADT,EAEKG,MAFL,CAEYX,UAFZ,EAGKY,IAHL,CAGUH,IAHV,CAFJ,EAOKP,KAPL,CAOWC,CAAC,IAAIV,GAAG,CAACkB,MAAJ,CAAW,GAAX,EAAgBE,GAAhB,EAPhB;AAQD;;AAGDtC,GAAG,CAACuC,GAAJ,CAAQ,QAAR,EAAkBC,eAAlB;AACAxC,GAAG,CAACyC,GAAJ,CAAQ,QAAR,EAAkBD,eAAlB;AACAxC,GAAG,CAAC+B,IAAJ,CAAS,YAAT,EAAuBV,YAAvB,EAAqCmB,eAArC;AACAxC,GAAG,CAAC+B,IAAJ,CAAS,aAAT,EAAwBS,eAAxB,E,CACA;;AACAxC,GAAG,CAACgB,GAAJ,CAAQ,YAAR,EAAsBwB,eAAtB,E,CACA;;AACAxC,GAAG,CAACgB,GAAJ,CAAQ,gBAAR,EAA0BwB,eAA1B;AACAxC,GAAG,CAACgB,GAAJ,CAAQ,2BAAR,EAAqCwB,eAArC;;AAEA,SAASA,eAAT,CAA0BvB,GAA1B,EAA+BC,GAA/B,EAAoC;AAChC,QAAMK,WAAW,GAAG,2BAAaN,GAAb,CAApB;AACA,sBAAmBM,WAAnB,EACKC,IADL,CACU,CAAC;AAAES,IAAAA,OAAF;AAAWR,IAAAA,UAAX;AAAuBS,IAAAA;AAAvB,GAAD,KACNhB,GAAG,CACEiB,GADL,CACSF,OADT,EAEKG,MAFL,CAEYX,UAFZ,EAGKY,IAHL,CAGUH,IAHV,CAFJ,EAOKP,KAPL,CAOWC,CAAC,IAAIV,GAAG,CAACkB,MAAJ,CAAW,GAAX,EAAgBE,GAAhB,EAPhB;AAQH;;AAIDtC,GAAG,CAACgB,GAAJ,CAAQ,aAAR,EAAuB0B,oBAAvB;AACA1C,GAAG,CAAC+B,IAAJ,CAAS,iBAAT,EAA4BW,oBAA5B;AACA1C,GAAG,CAAC2C,MAAJ,CAAW,iBAAX,EAA8BD,oBAA9B;AACA1C,GAAG,CAACgB,GAAJ,CAAQ,0BAAR,EAAoC0B,oBAApC;AACA1C,GAAG,CAACgB,GAAJ,CAAQ,wBAAR,EAAkC0B,oBAAlC;;AAGA,SAASA,oBAAT,CAA+BzB,GAA/B,EAAoCC,GAApC,EAAyC;AAEvC,QAAMK,WAAW,GAAG,2BAAaN,GAAb,CAApB;AACA,2BAAwBM,WAAxB,EACGC,IADH,CACQ,CAAC;AAAES,IAAAA,OAAF;AAAWR,IAAAA,UAAX;AAAuBS,IAAAA;AAAvB,GAAD,KACJhB,GAAG,CACAiB,GADH,CACOF,OADP,EAEGG,MAFH,CAEUX,UAFV,EAGGY,IAHH,CAGQH,IAHR,CAFJ,EAOGP,KAPH,CAOSC,CAAC,IAAIV,GAAG,CAACkB,MAAJ,CAAW,GAAX,EAAgBE,GAAhB,EAPd;AAQD;;AAMDtC,GAAG,CAAC+B,IAAJ,CAAS,iBAAT,EAA4Ba,oBAA5B;AACA5C,GAAG,CAACyC,GAAJ,CAAQ,aAAR,EAAuBG,oBAAvB;AACA5C,GAAG,CAAC+B,IAAJ,CAAS,oBAAT,EAA+Ba,oBAA/B;AACA5C,GAAG,CAAC2C,MAAJ,CAAW,oBAAX,EAAiCC,oBAAjC;AACA5C,GAAG,CAACgB,GAAJ,CAAQ,iBAAR,EAA2B4B,oBAA3B;AACA5C,GAAG,CAACgB,GAAJ,CAAQ,oBAAR,EAA8B4B,oBAA9B;;AAEA,SAASA,oBAAT,CAA+B3B,GAA/B,EAAoCC,GAApC,EAAyC;AAEvC,QAAMK,WAAW,GAAG,2BAAaN,GAAb,CAApB;AACA,4BAAwBM,WAAxB,EACGC,IADH,CACQ,CAAC;AAAES,IAAAA,OAAF;AAAWR,IAAAA,UAAX;AAAuBS,IAAAA;AAAvB,GAAD,KACJhB,GAAG,CACAiB,GADH,CACOF,OADP,EAEGG,MAFH,CAEUX,UAFV,EAGGY,IAHH,CAGQH,IAHR,CAFJ,EAOGP,KAPH,CAOSC,CAAC,IAAIV,GAAG,CAACkB,MAAJ,CAAW,GAAX,EAAgBE,GAAhB,EAPd;AAQD;;AAIDtC,GAAG,CAACuC,GAAJ,CAAQ,OAAR,EAAiBM,cAAjB;AACA7C,GAAG,CAACgB,GAAJ,CAAQ,WAAR,EAAqB6B,cAArB;AACA7C,GAAG,CAACgB,GAAJ,CAAQ,mBAAR,EAA6B6B,cAA7B;;AAEA,SAASA,cAAT,CAAyB5B,GAAzB,EAA8BC,GAA9B,EAAmC;AACjC,QAAMK,WAAW,GAAG,2BAAaN,GAAb,CAApB;AACA,qBAAkBM,WAAlB,EACKC,IADL,CACU,CAAC;AAAES,IAAAA,OAAF;AAAWR,IAAAA,UAAX;AAAuBS,IAAAA;AAAvB,GAAD,KACNhB,GAAG,CACEiB,GADL,CACSF,OADT,EAEKG,MAFL,CAEYX,UAFZ,EAGKY,IAHL,CAGUH,IAHV,CAFJ,EAOKP,KAPL,CAOWC,CAAC,IAAIV,GAAG,CAACkB,MAAJ,CAAW,GAAX,EAAgBE,GAAhB,EAPhB;AAQD;;AAGDtC,GAAG,CAAC8C,MAAJ,CAAWrC,IAAX,EAAiB,MAAMoB,OAAO,CAACC,GAAR,CAAa,wBAAD,GAAyBpB,OAAO,CAACC,GAAR,CAAYC,IAArC,IAA6C,IAAzD,CAAvB;AAEA,MAAMmC,UAAU,GAAG1C,KAAK,CAAC2C,YAAN,CAAmB5B,WAAnB,EAAgCpB,GAAhC,CAAnB;AACA+C,UAAU,CAACD,MAAX,CAAkB,IAAlB","sourcesContent":["import express from 'express'\nimport bodyParser from 'body-parser'\n\nimport handleAuthRequest from './auth'\nimport handleStaffRequest from './staff'\nimport handleActivitiesRequest from './activities'\nimport handleSubscriberRequest from './subscribers'\nimport handleSendmailRequest from './mailer'\nimport adaptRequest from './helpers/adapt-request'\n\nvar cors = require('cors')\nconst app = express();\napp.use(bodyParser.json());\n\nconst fs = require('fs')\nconst https = require('https')\n\n\nconst cert = fs.readFileSync('src/certificate.crt')\nconst key = fs.readFileSync('src/private.key')\n\nconst port = process.env.PORT || 9090;\n\n//Middleware\napp.use(express.urlencoded({ extended: true}));\napp.use(express.json());\n\napp.use(cors());\n\napp.get('/.well-known/pki-validation/E6FE7FC5B510F05015C6F8BEC821E3A6.txt', (req, res) => {\n  res.sendFile('/home/ec2-user/backend/src/E6FE7FC5B510F05015C6F8BEC821E3A6.txt')\n})\n\nconst credentials = {\n  key,\n  cert\n}\n\nfunction authenticate (req, res, next) {\n  const httpRequest = adaptRequest(req)\n  \n  handleAuthRequest(httpRequest)\n      .then(({ statusCode }) => {\n       \n        if(statusCode == 200){\n          next();\n        } \n        else {\n          // console.log(\"Unauthorized access\")\n          res.json({message: \"Unauthorized access\"})\n        }\n\n    })\n    .catch(e => {console.log(e)})\n}\n\n\napp.post('/sendmail', sendmailController);\napp.get('/sendmail', sendmailController);\n\nfunction sendmailController (req, res) {\n  const httpRequest = adaptRequest(req)\n  handleSendmailRequest(httpRequest)\n      .then(({ headers, statusCode, data }) =>\n      res\n          .set(headers)\n          .status(statusCode) \n          .send(data)\n      )\n      .catch(e => res.status(500).end())\n}\n\n\napp.all('/staff', staffController);\napp.put('/staff', staffController);\napp.post('/staff/add', authenticate, staffController);\napp.post('/staff/auth', staffController);\n// app.post('/staff/reset', staffController);\napp.get('/staff/:id', staffController);\n// app.delete('/staff/?id=:id', staffController);\napp.get('/staff/?id=:id', staffController);\napp.get('/staff/find/?email=:email', staffController);\n\nfunction staffController (req, res) {\n    const httpRequest = adaptRequest(req)\n    handleStaffRequest(httpRequest)\n        .then(({ headers, statusCode, data }) =>\n        res\n            .set(headers)\n            .status(statusCode) \n            .send(data)\n        )\n        .catch(e => res.status(500).end())\n}\n\n\n\napp.get('/activities', activitiesController);\napp.post('/activities/add', activitiesController);\napp.delete('/activities/:id', activitiesController);\napp.get('/activities?month=:month', activitiesController);\napp.get('/activities?year=:year', activitiesController);\n\n\nfunction activitiesController (req, res) {\n  \n  const httpRequest = adaptRequest(req)\n  handleActivitiesRequest(httpRequest)\n    .then(({ headers, statusCode, data }) =>\n      res\n        .set(headers)\n        .status(statusCode) \n        .send(data)\n    )\n    .catch(e => res.status(500).end())\n}\n\n\n\n\n\napp.post('/subscriber/add', subscriberController);\napp.put('/subscriber', subscriberController);\napp.post('/subscriber/update', subscriberController);\napp.delete('/subscriber?id=:id', subscriberController);\napp.get('/subscriber/:id', subscriberController);\napp.get('/subscriber?id=:id', subscriberController);\n\nfunction subscriberController (req, res) {\n  \n  const httpRequest = adaptRequest(req)\n  handleSubscriberRequest(httpRequest)\n    .then(({ headers, statusCode, data }) =>\n      res\n        .set(headers)\n        .status(statusCode) \n        .send(data)\n    )\n    .catch(e => res.status(500).end())\n}\n\n\n\napp.all('/auth', authController);\napp.get('/auth/:id', authController);\napp.get('/auth/check_token', authController);\n\nfunction authController (req, res) {\n  const httpRequest = adaptRequest(req)\n  handleAuthRequest(httpRequest)\n      .then(({ headers, statusCode, data }) =>\n      res\n          .set(headers)\n          .status(statusCode) \n          .send(data)\n      )\n      .catch(e => res.status(500).end())\n}\n\n\napp.listen(port, () => console.log(`Listening on port 9090`+process.env.PORT || 9090));\n\nconst httpServer = https.createServer(credentials, app);\nhttpServer.listen(9443)"],"file":"index.js"}